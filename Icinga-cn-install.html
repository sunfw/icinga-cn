<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1138.51">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Times; min-height: 18.0px}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Times}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px STSong}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Times; background-color: #efefef}
    span.s1 {font: 14.0px STSong}
    span.s2 {font: 14.0px Times}
    span.s3 {font: 14.0px Helvetica}
  </style>
</head>
<body>
<p class="p1"><br></p>
<p class="p2">Icinga Installation Instructions</p>
<p class="p1"><br></p>
<p class="p2">--------------------------------</p>
<p class="p3">简单安装说明</p>
<p class="p3">一、设置指定的用户、密码和组（必须）</p>
<p class="p1"><br></p>
<p class="p2">useradd -M icinga -s /sbin/nologin<span class="Apple-converted-space"> </span></p>
<p class="p2">passwd icinga<span class="Apple-converted-space"> </span></p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">二、安装</span>icinga</p>
<p class="p3">首先需要确认<span class="s2">gd</span>是否支持<span class="s2">TTC,</span>如果不支持请重新编译<span class="s2">gd</span></p>
<p class="p2"><span class="s1">如果出现</span>configure.ac:64: error: possibly undefined macro: AM_ICONV <span class="s1">错误</span></p>
<p class="p2">configure<span class="s1">时加入</span>--enable-m4_pattern_allow</p>
<p class="p1"><br></p>
<p class="p2">linux<span class="s1">下编译</span>GD<span class="s1">（</span>freetype+libjpeg+libpng+fontconfig<span class="s1">）</span></p>
<p class="p2">tar zxvf libiconv-1.13.1.tar.gz</p>
<p class="p2">cd libiconv-1.13.1/</p>
<p class="p2">./configure --prefix=/usr/local/libiconv</p>
<p class="p2">make</p>
<p class="p2">make install</p>
<p class="p2">/sbin/ldconfig</p>
<p class="p1"><br></p>
<p class="p2">i386</p>
<p class="p2">ln -s /usr/local/libiconv/lib/* /usr/lib</p>
<p class="p2">x64</p>
<p class="p2">ln -s /usr/local/libiconv/lib/* /usr/lib64</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">#&gt; cd gd-2.0.35</p>
<p class="p2">#&gt; ./configure --prefix=/usr/local/gd2 --with-freetype=/usr/local/freetype --with-libiconv-prefix=/usr/local/libiconv --with-fontconfig=/usr/local/fontconfig</p>
<p class="p2">#&gt; make</p>
<p class="p2">#&gt; make install</p>
<p class="p1"><br></p>
<p class="p2">libdbi-0.8.4.tar.gz</p>
<p class="p2">#&gt; ./configure<span class="Apple-converted-space">  </span>--disable-docs</p>
<p class="p2">#&gt; make<span class="Apple-converted-space"> </span></p>
<p class="p2">#&gt; make install</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">安装</span> libdbi-drivers</p>
<p class="p2">#&gt; cd libdbi-drivers-0.8.3-1</p>
<p class="p2">#&gt; ./configure --with-&lt;rdbm&gt; --disable-docs</p>
<p class="p2">#&gt; ./configure --with-mysql --with-dbi-libdir=/usr/local/libdbi/lib --with-dbi-incdir=/usr/local/libdbi/include --disable-docs</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">Using the 64-bit-versions you have to specify the paths to the include- and lib-dir explicitly:</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span>#&gt; ./configure --with-&lt;rdbm&gt; --with-&lt;rdbm&gt;-incdir=/usr/include/&lt;rdbm&gt;/ --with-&lt;rdbm&gt;-libdir=/usr/lib64/ --disable-docs</p>
<p class="p1"><br></p>
<p class="p3">如需<span class="s2">p1.pl</span>支持，请确认系统已安装了<span class="s2">perl</span></p>
<p class="p3">如需<span class="s2">ssl</span>支持<span class="s2">,</span>请确认系统已安装了<span class="s2">openssl</span></p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">#&gt; tar xvzf icinga-cn-version</p>
<p class="p1"><br></p>
<p class="p2">#&gt; cd icinga</p>
<p class="p1"><br></p>
<p class="p2">#&gt; ./configure --prefix=/usr/local/icinga <span class="Apple-converted-space">  </span>--with-icinga-user=icinga -with-icinga-group=icinga -with-command-user=icinga --with-command-group=icinga <span class="Apple-converted-space">  </span>--enable-idoutils --with-httpd-conf=/etc/httpd/conf.d/<span class="Apple-converted-space">  </span>--with-gd-lib=/usr/local/gd2/lib<span class="Apple-converted-space">  </span>--with-gd-inc=/usr/local/gd2/include <span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span># --enable-idoutils <span class="s1">数据库支持</span></p>
<p class="p2"><span class="Apple-converted-space"> </span># --enable-embedded-perl<span class="Apple-converted-space">  </span><span class="s1">启用嵌入式</span>Perl<span class="s1">解释器</span></p>
<p class="p2"><span class="Apple-converted-space"> </span># --enable-ssl<span class="Apple-converted-space">  </span><span class="s1">使本地的</span>SSL<span class="s1">支持</span></p>
<p class="p3"><span class="s2"><span class="Apple-converted-space"> </span># --with-mail<span class="Apple-converted-space">  </span></span>设置邮件通知使用的程序，默认为Mutt</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">#&gt; make all</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">#&gt; make install<span class="Apple-converted-space"> </span></p>
<p class="p1"><br></p>
<p class="p2">#&gt; make install-init <span class="Apple-converted-space">  </span>#<span class="s1">加入到服务中</span>/etc/init.d/</p>
<p class="p1"><br></p>
<p class="p2">#&gt; make install-config #<span class="s1">生成配置文件（</span>cfg<span class="s1">）</span></p>
<p class="p2">#&gt; make install-api</p>
<p class="p1"><br></p>
<p class="p2">#&gt; make install-commandmode #<span class="s1">生成</span>icinga.cmd<span class="Apple-converted-space"> </span></p>
<p class="p2">#&gt; make install-idoutils #<span class="s1">默认已启用</span>ido2db</p>
<p class="p1"><br></p>
<p class="p2">#&gt; make install-webconf #<span class="s1">生成</span>apache<span class="s1">配置文件</span>/etc/httpd/conf.d</p>
<p class="p3">或</p>
<p class="p2">#&gt; make fullinstall</p>
<p class="p1"><br></p>
<p class="p2">ldd ido2db<span class="s1">查看加载模块</span></p>
<p class="p2">libdbi.so.1 =&gt; /lib64/libdbi.so.1</p>
<p class="p2">libdbi.so.1<span class="s1">默认的路径是</span>/lib64<span class="s1">或</span>/lib</p>
<p class="p1"><br></p>
<p class="p3">三、添加到启动列表中</p>
<p class="p1"><br></p>
<p class="p2">chkconfig --add icinga</p>
<p class="p1"><br></p>
<p class="p2">chkconfig --list icinga</p>
<p class="p1"><br></p>
<p class="p3">四、设置<span class="s2">web</span>页面登陆用户及密码<span class="s2">(</span>必须）</p>
<p class="p2"><span class="s1">默认用户名</span> icingaadmin <span class="s1">默认密码</span>admin</p>
<p class="p3">用户可自行修改，但必需确保与<span class="s2">cgi.cfg</span>中的认证用户保持一致</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">如</span>htpasswd -c /usr/local/icinga/etc/htpasswd.users icinga</p>
<p class="p1"><br></p>
<p class="p3">五、配置数据库支持</p>
<p class="p1"><br></p>
<p class="p3">创建数据库、用户、赋予权限及数据导入</p>
<p class="p2">MySQL:</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span># mysql -u root -p</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span>mysql&gt; CREATE DATABASE icinga;</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span>mysql&gt; GRANT USAGE ON *.* TO 'icinga'@'localhost' IDENTIFIED BY 'icinga' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;</p>
<p class="p2"><span class="Apple-converted-space"> </span>mysql&gt; GRANT SELECT , INSERT , UPDATE , DELETE ON icinga.* TO 'icinga'@'localhost';</p>
<p class="p1"><span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span>mysql&gt; FLUSH PRIVILEGES;</p>
<p class="p1"><span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span>mysql&gt; quit</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">导入</span>scheme<span class="s1">数据到</span>MySQL</p>
<p class="p2"><span class="Apple-converted-space"> </span># mysql -u root -p icinga &lt; /path/icinga-src/module/idoutils/db/mysql.sql</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">升级</span>MySQL<span class="s1">数据库</span></p>
<p class="p4">mysql -u root -p &lt;dbname&gt; &lt; mysql-upgrade-&lt;version&gt;.sql</p>
<p class="p1"><span class="Apple-converted-space"> </span></p>
<p class="p2">IDOUtils<span class="s1">配置文件</span></p>
<p class="p2"><span class="Apple-converted-space"> </span># vi /usr/local/icinga/etc/ido2db.cfg</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span>db_servertype=mysql</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_port=3306</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_user=icinga</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_pass=icinga</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">PostgreSQL:</p>
<p class="p1"><br></p>
<p class="p3"><span class="s2"><span class="Apple-converted-space"> </span>#</span>初始化数据库</p>
<p class="p2">service postgresql initdb</p>
<p class="p3">创建数据库和用户<span class="s2"><span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="Apple-converted-space"> </span>$psql</p>
<p class="p2"><span class="Apple-converted-space"> </span>postgres=# CREATE USER icinga;</p>
<p class="p2"><span class="Apple-converted-space"> </span>postgres=# ALTER USER icinga WITH PASSWORD 'icinga';</p>
<p class="p2"><span class="Apple-converted-space"> </span>postgres=# CREATE DATABASE icinga;</p>
<p class="p2"><span class="s1">导入</span>scheme<span class="s1">数据到</span>PostgreSQL</p>
<p class="p2"><span class="Apple-converted-space"> </span># <span class="s3">psql -U</span> root<span class="Apple-converted-space">  </span>-d icinga &lt; /path/icinga-src/module/idoutils/db/pgsql.sql</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">升级</span>PostgreSQL<span class="s1">数据库</span></p>
<p class="p4"><span class="s3">psql -U</span> root<span class="Apple-converted-space">  </span>-d &lt;dbname&gt; &lt; pgsql-upgrade-&lt;version&gt;.sql</p>
<p class="p2">postgres=# \quit</p>
<p class="p1"><br></p>
<p class="p2">Fedora/RHEL/CentOS:</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span># vi /var/lib/pgsql/data/pg_hba.conf</p>
<p class="p2">Edit the config e.g. like this (local user must be trusted)</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span># database administrative login by UNIX sockets</p>
<p class="p2"><span class="Apple-converted-space"> </span>local<span class="Apple-converted-space">    </span>all<span class="Apple-converted-space">        </span>postgres<span class="Apple-converted-space">                  </span>ident</p>
<p class="p2"><span class="Apple-converted-space"> </span># TYPE <span class="Apple-converted-space">  </span>DATABASE <span class="Apple-converted-space">  </span>USER <span class="Apple-converted-space">      </span>CIDR-ADDRESS <span class="Apple-converted-space">  </span>METHOD<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space"> </span>#icinga</p>
<p class="p2"><span class="Apple-converted-space"> </span>local<span class="Apple-converted-space">    </span>icinga <span class="Apple-converted-space">    </span>icinga<span class="Apple-converted-space">              </span>trust</p>
<p class="p2"><span class="Apple-converted-space"> </span># "local" is for Unix domain socket connections only</p>
<p class="p2"><span class="Apple-converted-space"> </span>local<span class="Apple-converted-space">    </span>all<span class="Apple-converted-space">        </span>all <span class="Apple-converted-space">                      </span>trust</p>
<p class="p2"><span class="Apple-converted-space"> </span># IPv4 local connections</p>
<p class="p2"><span class="Apple-converted-space"> </span>local<span class="Apple-converted-space">    </span>all<span class="Apple-converted-space">        </span>all<span class="Apple-converted-space">        </span>127.0.0.1/32 <span class="Apple-converted-space">  </span>trust</p>
<p class="p2"><span class="Apple-converted-space"> </span># IPV6 local connections</p>
<p class="p2"><span class="Apple-converted-space"> </span>local<span class="Apple-converted-space">    </span>all<span class="Apple-converted-space">        </span>all<span class="Apple-converted-space">        </span>::1/128<span class="Apple-converted-space">        </span>trust</p>
<p class="p1"><br></p>
<p class="p2">Reload and configure database scheme.</p>
<p class="p2"><span class="Apple-converted-space"> </span># /etc/init.d/postgresql reload</p>
<p class="p2"><span class="Apple-converted-space"> </span># cd /path/to/icinga-src/module/idoutils/db/pgsql</p>
<p class="p2"><span class="Apple-converted-space"> </span># psql -U icinga -d icinga &lt; pgsql.sql</p>
<p class="p1"><br></p>
<p class="p2">Edit the DB config file to customize IDOUtils</p>
<p class="p2"><span class="Apple-converted-space"> </span># vi /usr/local/icinga/etc/ido2db.cfg</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_servertype=pgsql</p>
<p class="p2">db_host=localhost</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_port=5432</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_user=icinga</p>
<p class="p2"><span class="Apple-converted-space"> </span>db_pass=icinga</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p2">Oracle:</p>
<p class="p1"><br></p>
<p class="p2">Create a database schema and username/password (refer to the Oracle documentation at http://www.oracle.com or consult your DBA). Import the database scheme with sqlplus (or your preferred method). Copy module/idoutils/db/oracle.sql to $ORACLE_HOME</p>
<p class="p1"><br></p>
<p class="p2"><span class="Apple-converted-space"> </span># su - oracle</p>
<p class="p2"><span class="Apple-converted-space"> </span>$ sqlplus dbuser/dbpass</p>
<p class="p2"><span class="Apple-converted-space"> </span>SQL&gt; @oracle.sql</p>
<p class="p2">Edit the DB config file to customize IDOUtils. Remember that Oracle ignores the db host, instead point db_name to //DBSERVER/DBNAME</p>
<p class="p1"><br></p>
<p class="p2"># vi /usr/local/icinga/etc/ido2db.cfg</p>
<p class="p2"><span class="Apple-converted-space">  </span>db_servertype=oracle</p>
<p class="p2"><span class="Apple-converted-space">  </span>db_port=1521</p>
<p class="p2"><span class="Apple-converted-space">  </span>db_user=icinga</p>
<p class="p2"><span class="Apple-converted-space">  </span>db_pass=icinga</p>
<p class="p1"><br></p>
<p class="p2">service ido2db start</p>
<p class="p2">service ido2db start</p>
<p class="p1"><br></p>
<p class="p2"><span class="s1">检验</span>icinga<span class="s1">配置</span></p>
<p class="p1"><br></p>
<p class="p2">/usr/local/icinga/bin/icinga -v /usr/local/icinga/etc/icinga.cfg</p>
<p class="p1"><br></p>
<p class="p2">Good luck!</p>
<p class="p1"><br></p>
<p class="p1"><br></p>
<p class="p1"><br></p>
</body>
</html>
